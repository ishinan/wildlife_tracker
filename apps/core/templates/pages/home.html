{% extends "base.html" %}

{% block title %}
sfbaWildlifeTracker - Home
{% endblock title %}

{% load static %}

{% block content %}
<div class="container-fluid fill">
  <div class="row">
    <div class="col-3 pagecol">

      <div class="row bs-example report-list-title">
        <div class="col ">
          <h3>Recent Reports:</h3>
        </div>
      </div>

      <div class="row bs-example">
        <div class="col listview">
          {% for report in reports %}
          {% if forloop.first %} {% else %}
          <hr> {% endif %}
          <div>
            <div class="report_title"><a id="marker_{{forloop.counter}}" href="#" onclick="marker_{{forloop.counter}}.openPopup();">{{report.type|truncatechars:100}}</a></div>
            {% if report.image %}
            <img class="mr-3 media-image" src="{{ report.image.url }}" alt="{{ report.type }}">
            {% else %}
            <img class="mr-3 media-image no-image" src="{% static 'images/noImageAvailable.png' %}" alt="(No image available)">
            {% endif %}
            <div class="report_date">{{ report.created }}</div>
            <div class="report_text">{{ report.text }}</div>
          </div>
          {% endfor %}
        </div>
      </div>
      <div class="row">
        <div class="col">
          <div class="report_button_row">
            <button class="btn btn-primary btn-block btn-lg w-100 h-100" onclick="window.location.href=/add-new/">New Report</button>
          </div>
        </div>
      </div>

  </div>
  <div class="col-9 mapcol">
    {% include "snippets/map.html" %}
  </div>
</div>
</div>

<script>
  //Get user location
  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(postPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
    }
  }

  //Send location to server
  function postPosition(position) {
    var latlon = {
      'lat': position.coords.latitude,
      'lon': position.coords.longitude
    };

    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/log_location/", true);
    xhttp.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
    xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhttp.send(JSON.stringify(latlon));
  }
</script>

{% endblock content %}

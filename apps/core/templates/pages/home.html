{% extends "base.html" %}

{% block title %}
sfbaWildlifeTracker - Home
{% endblock title %}

{% load static %}

{% block content %}
<div>
  <div class="row">
    <div class="col-sm-4">
      <div class="row bs-example report-list-title">
        <h3>Incident Reports</h3>
        <button class="btn btn-primary ml-auto"
        onclick="window.location.href=/add-new/">New Report</button>
      </div>
      <div class="row bs-example">
        <div class="listview">
        {% for report in reports %}
        {% if forloop.first %} {% else %} <hr> {% endif %}

        <div>
           {% if report.image %}
            <img class="mr-3 media-image" src="{{ report.image.url }}" alt="{{ report.type }}">
           {% else %}
            <img class="mr-3 media-image no-image" src="{% static 'images/noImageAvailable.png' %}" alt="(No image available)">
           {% endif %}
            <div class="report_title">{{ report.type }}</div>
            <div class="report_date">{{ report.created }}</div>
            <div class="report_text">{{ report.text }}</div>
         </div>
        {% endfor %}
        </div>

      </div>
    </div>
    <div class="col-8">

      {% include "snippets/map.html" %}
    </div>
  </div>
</div>

<script>

  //Get user location

  function getLocation() {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(postPosition);
    } else {
      x.innerHTML = "Geolocation is not supported by this browser.";
      // TODO: replace this with code to call alternative location reporting method.
    }
  }

  //Send location to server
  function postPosition(position) {
    var latlon = {'lat': position.coords.latitude,
                  'lon': position.coords.longitude};

    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/log_location/", true);
    xhttp.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
    xhttp.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
    xhttp.send(JSON.stringify(latlon));
  }
</script>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
</body>


{% endblock content %}
